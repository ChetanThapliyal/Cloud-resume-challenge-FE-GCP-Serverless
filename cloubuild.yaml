# Step 1: Build the Hugo container image
- name: 'gcr.io/hugo-build'
  args: ['build', '-t', 'gcr.io/$PROJECT_ID/my-hugo-site:latest', '.']
  cacheFrom: ['gcr.io/$PROJECT_ID/my-hugo-site:latest']

# Step 2: Push the Image to Artifact Registry (or your registry of choice)
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/my-hugo-site:latest']

# Step 3: Deploy to Cloud Run (using gcloud)
- name: 'gcr.io/cloud-builders/gcloud'
  args: 
    - 'run' 
    - 'deploy' 
    - 'my-hugo-site' # Replace with the name of your service 
    - '--image'
    - 'gcr.io/$PROJECT_ID/my-hugo-site:latest'
    - '--region'
    - 'us-central1' # Replace with your desired region
    - '--allow-unauthenticated' # For initial simplicity
  entrypoint: 'bash'
  script: |
    set -e
    gcloud run deploy $SERVICE_NAME \
      --image $IMAGE_NAME \
      --region $REGION \
      --allow-unauthenticated \
      --platform managed \
      --port 8080
